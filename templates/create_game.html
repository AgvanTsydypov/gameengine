{% extends "base.html" %}

{% block title %}Create Game - AI Game Studio{% endblock %}

{% block content %}
<main>
  <section class="hero">
    <div class="kicker"><span class="dot"></span>BUILD â€¢ ITERATE â€¢ PUBLISH</div>
    <h1>CREATE NEW GAME</h1>
    <p class="sub">Design your pixel-perfect game with AI assistance</p>
  </section>

  <section class="section">
    <div style="max-width: 800px; margin: 0 auto;">
      <div style="border: 2px solid var(--line); background: var(--card); padding: 24px;">
        <h2 style="color: var(--cyber); margin-bottom: 20px; text-align: center;">UPLOAD GAME</h2>
        
        <form id="upload-game-form" enctype="multipart/form-data">
          <div class="form-group">
            <label class="form-label" for="game-title">GAME TITLE</label>
            <input class="form-input" type="text" id="game-title" name="title" required placeholder="Enter your game title">
          </div>

          <div class="form-group">
            <label class="form-label" for="game-description">DESCRIPTION</label>
            <textarea class="form-input" id="game-description" name="description" rows="3" required placeholder="Describe your game..."></textarea>
          </div>

          <div class="form-group">
            <label class="form-label" for="game-file">HTML GAME FILE</label>
            <div class="file-upload-container">
              <input class="form-input" type="file" id="game-file" name="game_file" accept=".html,.htm" required>
              <div class="file-upload-info">
                <span style="color: var(--muted); font-size: 12px;">Upload your HTML game file (max 16MB)</span>
              </div>
            </div>
          </div>

          <button class="btn btn-cta form-submit" type="submit" style="margin-top: 16px;">
            <span>ðŸ“¤ UPLOAD GAME</span>
          </button>
        </form>

        <div id="upload-status" style="display: none; text-align: center; margin-top: 20px;">
          <div class="loading-animation">
            <span style="color: var(--cyber);">UPLOADING YOUR GAME</span>
            <div style="margin-top: 10px;">
              <span class="loading-dots">...</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Upload success message -->
      <div id="upload-success" style="display: none; margin-top: 40px; border: 2px solid var(--cyber); background: var(--card); padding: 24px; text-align: center;">
        <h2 style="color: var(--cyber); margin-bottom: 16px;">âœ… GAME UPLOADED SUCCESSFULLY!</h2>
        <p style="color: var(--text); margin-bottom: 20px;">Your HTML game has been uploaded and saved to your account.</p>
        <div style="display: flex; gap: 10px; justify-content: center;">
          <button class="btn btn-cta" onclick="viewMyGames()"><span>VIEW MY GAMES</span></button>
          <button class="btn btn-ghost" onclick="uploadAnother()"><span>UPLOAD ANOTHER</span></button>
        </div>
      </div>
    </div>
  </section>
</main>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
  const form = document.getElementById('upload-game-form');
  const status = document.getElementById('upload-status');
  const success = document.getElementById('upload-success');

  form.addEventListener('submit', function(e) {
    e.preventDefault();
    
    const formData = new FormData(form);
    const fileInput = document.getElementById('game-file');
    
    // Validate file
    if (!fileInput.files[0]) {
      App.showAlert('Please select an HTML file to upload.', 'error');
      return;
    }
    
    const file = fileInput.files[0];
    if (!file.name.toLowerCase().endsWith('.html') && !file.name.toLowerCase().endsWith('.htm')) {
      App.showAlert('Please select a valid HTML file.', 'error');
      return;
    }
    
    if (file.size > 16 * 1024 * 1024) { // 16MB limit
      App.showAlert('File size must be less than 16MB.', 'error');
      return;
    }
    
    // Show loading state
    form.style.display = 'none';
    status.style.display = 'block';
    
    // Upload file
    fetch('/upload-game', {
      method: 'POST',
      body: formData
    })
    .then(response => response.json())
    .then(data => {
      status.style.display = 'none';
      
      if (data.success) {
        success.style.display = 'block';
        App.showAlert('Game uploaded successfully!', 'success');
      } else {
        form.style.display = 'block';
        App.showAlert(data.error || 'Upload failed. Please try again.', 'error');
      }
    })
    .catch(error => {
      status.style.display = 'none';
      form.style.display = 'block';
      console.error('Upload error:', error);
      App.showAlert('Upload failed. Please try again.', 'error');
    });
  });
});

function viewMyGames() {
  window.location.href = '/my-games';
}

function uploadAnother() {
  document.getElementById('upload-game-form').style.display = 'block';
  document.getElementById('upload-success').style.display = 'none';
  document.getElementById('upload-game-form').reset();
}
</script>

<style>
.loading-dots {
  animation: dots 1.5s infinite;
}

@keyframes dots {
  0%, 20% { opacity: 0; }
  50% { opacity: 1; }
  100% { opacity: 0; }
}
</style>
{% endblock %}
